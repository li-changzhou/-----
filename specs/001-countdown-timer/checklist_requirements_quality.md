# 需求质量检查清单: 事件倒计时工具

**功能**: 事件倒计时工具  
**功能分支**: `001-countdown-timer`  
**创建时间**: 2026-01-22  
**规范版本**: 1.0 (已批准)  
**检查对象**: [spec.md](spec.md)  

**说明**: 此清单是需求编写的单元测试。它验证规范本身的质量、清晰度和完整性，而非实现的正确性。

---

## 📋 需求完整性检查

### 用户故事完整性

- [x] CHK001 - 是否为所有优先级级别（P1/P2/P3）定义了独立的用户故事？ [完整性, spec §用户场景]
- [x] CHK002 - 每个用户故事是否都明确说明了"独立测试"的方式？ [清晰度, spec §US1-US3]
- [x] CHK003 - 是否每个优先级都明确了其对应的版本号（v1.0/v1.1/v1.2）？ [完整性, spec §优先级原因]
- [x] CHK004 - 是否为所有故事定义了优先级理由（为什么是 P1/P2/P3）？ [完整性, spec §优先级原因]
- [x] CHK005 - P1 故事是否真正是最小可行产品（MVP）且能独立交付？ [清晰度, spec §P1 独立测试]
- [x] CHK006 - 是否为 P2/P3 故事定义了与 P1 的依赖关系？ [完整性, spec §故事依赖]
- [ ] CHK007 - 是否存在对错误处理流程的用户故事（作为独立故事）？ [覆盖度, Gap]

### 验收场景完整性

- [x] CHK008 - 所有验收场景是否都使用 BDD 格式（给定-当-那么）？ [清晰度, spec §验收场景]
- [x] CHK009 - 是否为每个故事都提供了至少 3 个验收场景？ [完整性, spec §验收场景]
- [x] CHK010 - 主要流程验收场景是否覆盖了快乐路径？ [覆盖度, spec §场景 1-3]
- [x] CHK011 - 是否为边界情况提供了具体的验收场景（而非仅说明）？ [部分, spec §边界情况]
  - ✅ 无效日期格式: 有具体场景
  - ✅ 过期日期: 有具体场景  
  - ⚠️ 重名事件: 仅说明，缺少具体验收场景 [Gap]
  - ⚠️ 系统日期修改: 仅说明，缺少具体验收场景 [Gap]
  - ⚠️ 多设备同步: 仅说明，缺少具体验收场景 [Gap]

- [x] CHK012 - 是否为 P2 小卡片每日更新时机定义了验收场景？ [清晰度, spec §P2 场景 2]
- [x] CHK013 - 是否为数据删除后的状态变化定义了验收场景？ [完整性, spec §P1 场景 4, P2 场景 4]
- [ ] CHK014 - 是否为异常关闭或中断后的数据恢复定义了验收场景？ [覆盖度, Gap]

---

## 🎯 需求清晰性检查

### 功能需求的明确性

- [x] CHK015 - 是否为每个功能需求都使用了"必须"而非"应该"或"可能"？ [清晰度, spec §功能需求]
- [x] CHK016 - 日期格式需求是否明确指定了 YYYY-MM-DD？ [清晰度, spec §FR-001]
- [x] CHK017 - 天数计算是否明确说明了"距离...还有 n 天"的具体格式？ [清晰度, spec §FR-003]
- [x] CHK018 - 是否为"显示 0 天"而非负数明确说明了原因（当前日期≥目标日期）？ [清晰度, spec §FR-006]
- [ ] CHK019 - 是否明确定义了"可选"通知的实现方式（如何选择不通知）？ [清晰度, Gap]
- [x] CHK020 - 事件名称的唯一性是否明确（允许重名吗？覆盖吗？拒绝吗？）？ [部分, spec §边界情况]
  - ⚠️ 提到"系统应拒绝或提示是否覆盖"但规范中未确定选择 [Ambiguity]

### 非功能需求的可衡量性

- [x] CHK021 - CLI 响应时间是否量化了具体数值（< 500ms）？ [清晰度, spec §NFR-002]
- [x] CHK022 - API 响应时间是否指定了百分位数（p95）而非平均值？ [清晰度, spec §NFR-003]
- [x] CHK023 - 天数计算精度是否明确为"100%"而非"准确"？ [清晰度, spec §NFR-001]
- [x] CHK024 - 是否为并发事件数量设置了具体目标（100+）？ [清晰度, spec §NFR-004]
- [x] CHK025 - 倒计时时间范围是否明确（100 年到 2126 年）？ [清晰度, spec §NFR-005]
- [ ] CHK026 - 内存占用是否有明确限制？ [缺失, Gap]
- [ ] CHK027 - 数据恢复时间（如从 JSON 到 SQLite 迁移）是否有要求？ [缺失, Gap]

### 数据模型的明确性

- [x] CHK028 - 每个实体的属性是否都明确了数据类型（string/int/date/enum）？ [清晰度, spec §Event 属性]
- [x] CHK029 - Event.name 是否明确定义为"唯一标识符"？ [清晰度, spec §Event 属性]
- [x] CHK030 - remaining_days 是否明确说明为"计算属性"？ [清晰度, spec §Event 属性]
- [x] CHK031 - 状态枚举（ACTIVE/EXPIRED）是否涵盖了所有可能的状态？ [部分, spec §Event 属性]
  - ❓ 是否应有 DELETED 状态？ [Ambiguity]
  - ❓ 是否应有 PAUSED 状态（P2 中提到暂停事件通知）？ [Ambiguity]

- [x] CHK032 - Notification 的 days_before 是否允许负数或零？ [缺失, spec §Notification]
- [ ] CHK033 - Widget.device_id 的格式是否定义（UUID/UUID4/String）？ [缺失, Gap]

---

## 🔄 需求一致性检查

### 跨文档一致性

- [x] CHK034 - 用户故事中的验收场景与功能需求是否相互支撑？ [一致性, spec §全部]
  - ✅ 故事 1 验收场景 1-6 覆盖了 FR-001 到 FR-008
  - ✅ 功能需求映射清晰

- [x] CHK035 - 非功能需求是否与功能需求的工作量相符？ [一致性, spec §功能/非功能]
  - ✅ "支持 100+ 事件"与"快速响应"相符
  - ✅ "天级精度"简化了复杂度要求

- [x] CHK036 - 超出范围声明是否与功能需求中的限制一致？ [一致性, spec §超出范围]
  - ✅ 不支持 GUI，但支持 CLI/API [一致]
  - ✅ 不支持实时显示，但支持天级更新 [一致]

- [x] CHK037 - 成功标准是否与验收场景对齐？ [一致性, spec §成功标准]
  - ✅ SC-001/SC-006: 响应时间对标 NFR-002
  - ✅ SC-002: 精度对标 NFR-001
  - ✅ SC-004: 覆盖率对标所有测试

### 术语一致性

- [x] CHK038 - "倒计时"一词在规范中的含义是否一致（日期倒计时而非秒级计时）？ [一致性, spec §全部]
- [x] CHK039 - "事件"一词是否一致使用（而非"计时"或"提醒"）？ [一致性, spec §全部]
- [x] CHK040 - 状态名称是否一致（ACTIVE/EXPIRED 而非 RUNNING/DONE）？ [一致性, spec §数据模型]
- [ ] CHK041 - "显示"vs "返回" vs "输出"是否区分明确（CLI 显示、API 返回）？ [模糊, 部分 Ambiguity]

---

## ✅ 验收标准质量检查

### 可衡量性

- [x] CHK042 - 所有成功标准是否都是可衡量的（而非主观的）？ [清晰度, spec §成功标准]
  - ✅ SC-001: "< 2 秒" [可衡量]
  - ✅ SC-002: "100%" [可衡量]
  - ✅ SC-004: "≥ 90%" [可衡量]
  - ✅ SC-005: "所有主流平台" [可衡量]

- [ ] CHK043 - SC-006 的"< 2 分钟"是否有测试环境定义（在什么配置下）？ [清晰度, Gap]
- [x] CHK044 - SC-007 的"错误消息清晰"是否有具体的评估标准？ [缺失, Gap]
  - 💡 建议: 定义"用户能在 X 秒内理解并修正"

### 可验证性

- [x] CHK045 - 是否所有成功标准都可通过自动化测试验证？ [验收标准质量]
  - ✅ SC-001-005: 可自动化
  - ⚠️ SC-006: "新手用户"定义不明确，难以自动化
  - ⚠️ SC-007: 需要人工评估

- [ ] CHK046 - 是否为 P2 小卡片显示定义了验证标准（刷新率、准确性）？ [缺失, Gap]

---

## 🎨 场景覆盖度检查

### 主要流程

- [x] CHK047 - 是否覆盖了"创建单个事件"流程？ [覆盖度, spec §P1 场景 1]
- [x] CHK048 - 是否覆盖了"查询事件列表"流程？ [覆盖度, spec §P1 场景 3]
- [x] CHK049 - 是否覆盖了"删除事件"流程？ [覆盖度, spec §P1 场景 4]
- [ ] CHK050 - 是否覆盖了"修改事件"流程（编辑日期或名称）？ [覆盖度, Gap]

### 异常流程

- [x] CHK051 - 是否覆盖了"无效输入"的错误处理？ [覆盖度, spec §P1 场景 5]
- [x] CHK052 - 是否覆盖了"过期日期"的处理？ [覆盖度, spec §P1 场景 6]
- [ ] CHK053 - 是否覆盖了"存储满"或"磁盘空间不足"的错误处理？ [覆盖度, Gap]
- [ ] CHK054 - 是否覆盖了"权限错误"（无法写入 ~/.countdown）的处理？ [覆盖度, Gap]

### 边界情况

- [x] CHK055 - 是否为"0 天"（当前日期等于目标日期）定义了行为？ [覆盖度, spec §P1 场景 2]
- [x] CHK056 - 是否为"超长倒计时"（100 年）定义了行为？ [覆盖度, spec §NFR-005]
- [ ] CHK057 - 是否为"最小倒计时"（1 天）定义了行为？ [覆盖度, Gap]
- [ ] CHK058 - 是否为"空列表"（无事件）定义了行为？ [覆盖度, Gap]
- [ ] CHK059 - 是否为"并发创建相同事件"定义了行为？ [覆盖度, Gap]

### 非功能场景

- [x] CHK060 - 是否为"高并发"（100+ 事件同时查询）定义了需求？ [覆盖度, spec §NFR-004]
- [ ] CHK061 - 是否为"低网络带宽"定义了 API 行为（P2）？ [覆盖度, Gap]
- [ ] CHK062 - 是否为"设备离线"定义了小卡片行为（P2）？ [覆盖度, Gap]
- [ ] CHK063 - 是否为"大数据集导入/导出"定义了性能需求？ [覆盖度, Gap]

---

## 🔍 边缘情况覆盖度检查

### 数据边界

- [x] CHK064 - 事件名称长度是否有限制定义？ [缺失, Gap]
  - 💡 建议: 定义最大长度（如 256 字符）

- [ ] CHK065 - 是否为"事件名称中的特殊字符"定义了处理（如 quotes/slashes）？ [覆盖度, Gap]

- [x] CHK066 - 日期范围是否定义了边界（最早日期、最晚日期）？ [清晰度, spec §NFR-005]
  - ✅ 最晚：2126 年 (100 年后)
  - ❓ 最早：是否允许历史日期（已过期）？ [Ambiguity, spec §边界情况]

### 系统边界

- [ ] CHK067 - 是否为"系统时钟被修改"定义了处理？ [覆盖度, Gap]
  - 💡 当前在边界情况中提到但未定义行为

- [ ] CHK068 - 是否为"时区变更"定义了处理（用户更改系统时区）？ [覆盖度, Gap]

- [ ] CHK069 - 是否为"数据文件损坏"定义了恢复策略？ [覆盖度, Gap]

### 并发边界

- [ ] CHK070 - 是否为"同时从多个 CLI 实例创建相同事件"定义了行为？ [覆盖度, Gap]

- [ ] CHK071 - 是否为"P1 和 P2 同时访问数据"定义了锁定策略（JSON vs SQLite）？ [覆盖度, Gap]

---

## 📚 依赖关系与假设检查

### 明确的依赖关系

- [x] CHK072 - 是否明确了 P2 对 P1 的依赖？ [完整性, spec §P2 优先级原因]
- [x] CHK073 - 是否明确了 P3 对 P1/P2 的可选依赖？ [完整性, spec §P3 优先级原因]
- [ ] CHK074 - 是否定义了从 JSON (P1) 到 SQLite (P2) 的迁移要求？ [依赖关系, Gap]

### 隐含的假设

- [x] CHK075 - 是否假设了"用户总是输入有效的日期格式"？[假设检查, spec §FR-005]
  - ✅ 假设被验证需求明确处理
  
- [x] CHK076 - 是否假设了"系统时区始终正确"？ [假设检查, spec §边界情况]
  - ⚠️ 提到"修改系统日期"但未覆盖时区变更

- [ ] CHK077 - 是否假设了"文件系统始终可写"？ [假设检查, Gap]

- [ ] CHK078 - 是否假设了"网络连接始终可用"（对 P2 API）？ [假设检查, Gap]

---

## 🏗️ 架构与分解清晰性检查

### 模块化定义

- [x] CHK079 - 是否明确了 CLI 和 API 的分离（P1 vs P2）？ [清晰度, spec §超出范围]
- [x] CHK080 - 是否明确了移动应用与后端的交互方式（REST API）？ [清晰度, spec §FR-009]
- [x] CHK081 - 是否明确了通知服务与主应用的分离（P3）？ [清晰度, spec §P3 功能需求]

### 数据流定义

- [ ] CHK082 - 是否明确了"创建事件"的数据流（CLI → EventManager → Storage）？ [清晰度, Gap]

- [ ] CHK083 - 是否明确了"查询事件"的数据流（P2 API 如何从 SQLite 读取）？ [清晰度, Gap]

- [ ] CHK084 - 是否明确了"小卡片更新"的数据流（计划任务 → API → Widget）？ [清晰度, Gap]

---

## 🎓 模糊性与冲突检查

### 需要澄清的歧义

| # | 歧义 | 位置 | 影响 | 建议 |
|---|------|------|------|------|
| A1 | 重名事件处理（拒绝/覆盖/允许并查询） | 边界情况 | 设计 | 明确选择一种 |
| A2 | Event 状态是否需要 DELETED？ | 数据模型 | 数据库迁移 | 定义所有状态 |
| A3 | CLI 输出与 API 返回的差异 | 显示/返回 | 文档 | 明确定义格式 |
| A4 | 事件名称的长度限制 | 功能需求 | 存储 | 设定最大值 |

### 需要确认的冲突

| # | 冲突 | 位置 | 建议 |
|----|------|------|------|
| C1 | "显示 0 天"vs "显示已过期" | 场景 6 | 统一为一种表述 |
| C2 | P2 中"每天 00:00 UTC"vs 用户时区 | NFR-002 | 明确时区处理 |

---

## 📊 需求质量汇总

### 按维度评分

```
完整性:        ⭐⭐⭐⭐  (4/5)
  ✅ 用户故事、验收场景、需求都完整
  ⚠️  缺少错误处理故事、边界情况验收场景、某些非功能要求
  
清晰性:        ⭐⭐⭐⭐  (4/5)
  ✅ 功能需求明确、数据模型清晰
  ⚠️  存在模糊术语、缺少某些细节定义
  
一致性:        ⭐⭐⭐⭐  (4/5)
  ✅ 故事/需求/标准总体对齐
  ⚠️  存在术语不一致、某些冲突
  
可测试性:      ⭐⭐⭐  (3/5)
  ✅ 验收场景和成功标准大多可自动化
  ⚠️  部分成功标准难以自动化（如"新手用户"）
  ⚠️  缺少某些场景的验收标准
  
覆盖度:        ⭐⭐⭐  (3/5)
  ✅ 主要流程和边界情况覆盖
  ⚠️  缺少异常处理、并发场景、数据恢复等
  ⚠️  P2/P3 覆盖不如 P1
  
━━━━━━━━━━━━━━━━━━━━━━━━━
总体质量:      ⭐⭐⭐⭐  (3.8/5)
```

---

## 🎯 改进建议（优先级）

### 🔴 P1: 必须修复（阻塞实施）

1. **确定重名事件处理**
   - 当前: "系统应拒绝或提示是否覆盖旧事件"（歧义）
   - 建议: "系统应拒绝并返回错误"或"系统应覆盖旧事件（需用户确认）"

2. **为边界情况添加验收场景**
   - 重名事件: 缺少验收场景
   - 系统日期修改: 缺少验收场景  
   - 多设备同步: 缺少验收场景

3. **定义所有 Event 状态**
   - 当前: 仅 ACTIVE, EXPIRED
   - 缺少: DELETED？PAUSED？

### 🟠 P2: 应该修复（提高清晰度）

4. **定义数据长度限制**
   - 事件名称最大长度（建议: 256 字符）
   - 日期范围最早值（建议: 允许历史日期）

5. **定义错误场景的处理**
   - 数据文件损坏
   - 磁盘空间不足
   - 权限错误

6. **P2/P3 的非功能需求细化**
   - 离线模式下的小卡片行为
   - 通知失败的重试策略
   - 数据同步一致性保证

### 🟡 P3: 可选改进（增强文档）

7. **添加数据流图**
   - 创建事件的数据流
   - 查询事件的数据流
   - 小卡片更新的数据流

8. **定义时区处理策略**
   - P1 使用本地时区
   - P2 使用 UTC
   - 两者之间的转换

---

## 📝 检查清单使用说明

### 如何使用此清单

1. **规范评审**: 开发前用此清单评审需求
2. **需求缺陷修复**: 根据建议改进规范
3. **设计验证**: 设计时确保规范覆盖所有场景
4. **测试设计**: 根据验收场景设计测试用例

### 检查项含义

- ✅ **通过** - 需求满足此检查项
- ⚠️ **部分** - 需求部分满足，需改进
- ❌ **失败** - 需求未满足此检查项
- [ ] **空白** - 未完成检查或暂无此需求

---

## 🔗 参考文档

- [spec.md](spec.md) - 完整功能规范
- [SPEC_ANALYSIS.md](SPEC_ANALYSIS.md) - 初稿分析
- [REVISION_SUMMARY.md](REVISION_SUMMARY.md) - 修订对比

---

**检查完成时间**: 2026-01-22  
**检查者**: GitHub Copilot  
**规范版本**: 1.0  
**检查版本**: 1.0

